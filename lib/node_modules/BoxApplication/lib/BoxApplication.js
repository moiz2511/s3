!function(){"use strict";var e=require("winston"),r=require("util"),n=require("underscore"),t=require("IpcFramework"),o=require("apps/Logger/IpcTransport").Ipc,i=parseInt(process.env.npm_config_adl_logger_port,10)||12346;e.transports.Ipc=o;var s=function(r){t.IpcClient.call(this);var o=this;if(r=r||{},"ignore"!==r.log){var s=n.defaults(r.log||{},{ipc:{level:"silly",loggerPort:i},console:{level:"silly",timestamp:!0}});n.each(s,function(e){e.label=r.name}),e.default.transports.console.label=r.name,e.loggers.options=s,this.logger=e.loggers.add(r.name,s),this.logger.extend(this)}this.local=e,this.name=r.name,process.on("message",function(e){o.message(e)}),process.on("uncaughtException",function e(r){o.error(r.stack),process.removeListener("uncaughtException",e),n.delay(function(){throw r},3e3)})};r.inherits(s,t.IpcClient),s.prototype.use=function(e,r,t){var o,i=this,s=n.rest(arguments);return n.isArray(e)?void n.each(e,function(e){var r=[e].concat(s);i.use.apply(i,r)}):(n.isFunction(e)?(!r||t||r.require||(t=r,r=null),o=e):o=r.require(e),void o(i,t))},s.prototype.ready=function(e){void 0!==e?(e instanceof Error&&(e=n.chain(Object.getOwnPropertyNames(e)).map(function(r){return[r,e[r]]}).object().value()),this.queue("ready",{name:require.main.filename,err:e},"supervisor")):this.queue("ready",{name:require.main.filename},"supervisor")},s.prototype.disconnect=function(){this.logger&&this.logger.close(),t.IpcClient.prototype.disconnect.call(this)},module.exports=function(e){var r=new s(e);return r}}();