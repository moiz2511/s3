var Socket=require("./sock"),Message=require("amp-message"),_=require("underscore"),IpcSocket=function(){Socket.call(this),this._queue=[];var e=this;this.on("connect",function(){var t=e._queue,o=t.length;e._queue=[];for(var c=0;c<o;++c)e.send.apply(e,t[c]);e.emit("flush",t)})};IpcSocket.prototype.__proto__=Socket.prototype,IpcSocket.prototype.onmessage=function(e){var t=this;return function(o){var c=new Message(o);t.emit.apply(t,["message",e].concat(c.args))}},IpcSocket.prototype.send=function(e,t,o){var c=this,s=function(t,o,s){for(var r,i=o.length,n=0;n<i;++n)if(r=o[n],r.writable)try{r.write(t,void 0,s)}catch(e){}else c._queue.push([e,r,s])};!o&&_.isFunction(t)&&(o=t,t=void 0);var r=this.socks,i=r.length,n=this.pack([e]);t?s(n,[t],o):0!==i?s(n,r,o):this._queue.push([e,t,o])},exports.IpcSocket=IpcSocket;