var util=require("util"),_=require("underscore"),winston=require("winston"),ipcFramework=require("IpcFramework"),Ipc=exports.Ipc=function(t){winston.Transport.call(this,t),t=t||{},this.json=t.json||!1,this.colorize=t.colorize||!1,this.prettyPrint=t.prettyPrint||!1,this.timestamp="undefined"!=typeof t.timestamp&&t.timestamp,this.label=t.label||null,this.seq=0,this.socket=ipcFramework.socket(),this.socket.connect(t.loggerPort,"127.0.0.1"),this.json&&(this.stringify=t.stringify||function(t){return JSON.stringify(t,null,2)})};util.inherits(Ipc,winston.Transport),Ipc.prototype.name="ipc",Ipc.prototype.log=function(t,e,i,r){if(this.silent)return r(null,!0);var n=this;i instanceof Error&&(i=_.chain(Object.getOwnPropertyNames(i)).map(function(t){return[t,i[t]]}).object().value()),n.socket.send({level:t,logMessage:e,meta:i,app:n.label,seq:n.seq+=1}),n.emit("logged"),r(null,!0)},Ipc.prototype.close=function(){this.socket.close()};