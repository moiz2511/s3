!function(){"use strict";var e=require("underscore"),r=require("winston"),o=require("mkdirp"),n=require("ipcFramework"),t=require("environment"),i=require("FileUtility"),s=require("Protocol"),a=require("BoxApplication"),c=require("./config.js"),u=a(c);o.sync(t.boxLogs),u.on(s.clearBoxLogs,function(e,r){i.clearDirectory(t.boxLogs,function(e){e?u.error("Clearing box logs error. ",e):l(),r({error:e})})});var l=function(){e.each(p.transports,function(e){p.remove(e)}),e.each(c.logger,function(e,o){var n=function(e){return e&&e[0].toUpperCase()+e.slice(1)};if(!r.transports[n(o)])throw new Error("Unable to add logger of type: "+o);p.add(r.transports[n(o)],e)}),p.transports.file&&p.transports.file.on("open",function(){p.transports.file.flush()})},p=new r.Logger;l();var f=n.socket();f.bind(c.loggerPort,"127.0.0.1"),f.on("message",function(r,o){var n={app:o.app,meta:o.meta,seq:o.seq};e.isEmpty(n.meta)&&delete n.meta,p.log(o.level,o.logMessage,n)}),u.on("stop",function(){f.closeServer(),u.disconnect()}),process.on("SIGINT",function(){}),u.ready()}();