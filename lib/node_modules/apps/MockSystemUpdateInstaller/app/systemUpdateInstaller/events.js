!function(){"use strict";function n(n,s){n.on(t.newSoftwareUpdate,function(e,i){c(r.updateStagingPath,function(o){if(o)return void i(o);var u=e+".zip",s=a.join(r.updatesPath,u);l(s,function(o){return o?void i(o):(n.broadcast(t.emitNewVersion,{newVersion:e}),void i(o))})})});var c=function(n,t){e.clearDirectory(n,function(n){t(n)})},l=function(n,t){o.createReadStream(n).pipe(i.Extract({path:r.updateStagingPath})).on("close",function(){o.unlink(n,function(n){n&&"ENOENT"!=n.code?t(n):t()})}).on("error",function(n){t(n)})};n.on(t.startInstallation,function(n,t){try{var e=a.join(r.updateStagingPath,n.availableVersion,"update.exe");u.spawn(e),t()}catch(n){t(n)}}),n.on(t.getInstallationDisposition,function(n,t){t({installationDisposition:"successful",installationCompletionTime:new Date})})}var t=require("../../../SystemUpdateInstaller/node_modules/Protocol.js"),e=require("FileUtility"),i=(require("underscore"),require("unzip2")),o=require("fs"),r=require("Environment"),a=require("path"),u=require("child_process");module.exports=n}();