!function(){"use strict";function i(i,a){i.on(n.newSoftwareUpdate,function(a,s){var c=a.newVersion;u(r.updateStagingPath,function(u){if(u)return i.error("Error clearing the staging directory",u),void s(u);var l=c+".zip",d=o.join(r.updatesPath,l),f=o.join(r.updateStagingPath,c);e.extractZipToLocation(d,f,function(e){return e?void s(e):void t.unlink(d,function(e){e&&i.error("Error deleting staging file",e),i.broadcast(n.emitNewVersion,a),s()})})})});var u=function(i,n){e.clearDirectory(i,function(i){n(i)})};i.on(n.getInstallationDisposition,function(i,n){n({installationDisposition:"successful",installationCompletionTime:new Date})})}var n=require("../node_modules/Protocol.js"),e=require("FileUtility"),t=(require("underscore"),require("fs")),r=require("Environment"),o=require("path");module.exports=i}();