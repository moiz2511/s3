"use strict";var events=require("events"),util=require("util"),_=require("underscore"),HybridSessionStore=function(e){events.EventEmitter.call(this),this._options=_.defaults({},e,{maxAge:6e4}),this._maxAge=this._options.maxAge,this._sessions={}};util.inherits(HybridSessionStore,events.EventEmitter),HybridSessionStore.prototype.expiredSessions=function(e){var s=new Date,t=_.chain(this._sessions).values().filter(function(e){return e.expires<s}).indexBy("id").value();e(null,t)},HybridSessionStore.prototype.all=function(e){var s=_.chain(this._sessions).map(function(e,s){return[s,e.data]}).object().value();e(void 0,s)},HybridSessionStore.prototype.destroy=function(e){var s=this._sessions[e];delete this._sessions[e],this.emit("sessionDestroyed",e,s.data)},HybridSessionStore.prototype.get=function(e,s){s(this._sessions[e]?this._sessions[e].data:void 0)};var calculateExpiration=function(e,s){return new Date(e.getTime()+s)};HybridSessionStore.prototype.store=function(e,s){var t=this._sessions[e]={id:e,expires:calculateExpiration(new Date,this._maxAge),data:s};return this.emit("sessionUpdated",e,t.data),t},HybridSessionStore.prototype.update=function(e){this._sessions[e]&&(this._sessions[e].expires=calculateExpiration(new Date,this._maxAge))},module.exports=HybridSessionStore;