"use strict";var events=require("events"),util=require("util"),_=require("underscore"),ServerManager=function(e){events.EventEmitter.call(this);var t=this;this.sockets=[],this.server=e;var s=function(e){t.sockets.push(e),e.once("close",function(){t.sockets=_.without(t.sockets,e),0===t.sockets.length&&t.closingTimeout&&(clearTimeout(t.closingTimeout),t.emit("close"))})};e.on("connection",s)};util.inherits(ServerManager,events.EventEmitter),ServerManager.prototype.close=function(e){var t=this;t.server.close(),0!==t.sockets.length?t.closingTimeout=setTimeout(function(){_.each(t.sockets,function(e){e.destroy()}),t.sockets=[],t.emit("close")},e):t.emit("close")},exports.ServerManager=ServerManager;