"use strict";var fs=require("fs"),path=require("path"),_=require("underscore"),environment=require("Environment"),middleware=require("../middleware"),setup=function(e,r){var n=r.services.noSessionServices;n.use("/SAWeb/services/BackgroundImage",middleware.addCorsHeaders()),n.use("/SAWeb/services/BackgroundImage",function(r,n,i){fs.exists(path.join(environment.backgroundImagesFolder,"Originals"),function(r){if(!r)return e.error("Unable to find directory 'Originals' in path"+environment.backgroundImagesFolder),void i();var a=path.join(environment.backgroundImagesFolder,"Originals");fs.readdir(a,function(r,a){if(r||_.isEmpty(a))return e.error("Error in reading files for background image",r),void i();var s=_.chain(a).shuffle().first().value();n.send(s)})})}),n.use("/WebSA/Data/background-images",middleware.addCorsHeaders()),n.use("/WebSA/Data/background-images",function(e,r,n){var i=path.join(environment.backgroundImagesFolder,e.path);r.sendfile(i)})};module.exports=setup;