!function(){"use strict";var e=require("express"),r=require("underscore"),o=(require("async"),require("url")),s=function(s,t){var a=t.webServer,n=t.config,d=t.networkContext;a.post("/SAWeb/services/search/jobs",e.bodyParser(),function(e,t){var a={"Content-Type":"application/x-www-form-urlencoded",charset:"UTF-8",SOLR_USER:e.headers["x-user"]},i={q:e.body.q,start:e.body.start||0,rows:e.body.rows||10},c=o.format({protocol:n.protocol,hostname:n.hostname,port:n.port,pathname:n.searchJobsUrl,query:i});d.post({url:c,headers:a},function(e,o){if(e)return s.error("Request To SOLR Failed: ",e),void t.send(500,"Internal Server Error.");try{var a=JSON.parse(o.body)}catch(e){return s.error("Error Parsing JSON: ",e),void t.send(500,"Internal Server Error.")}if(a.error)return s.error("Error Received From SOLR Request: ",a.error.msg),void t.send(502,"Bad Gateway");if(!a.response||!r.isArray(a.response.docs))return s.error("Unexpected Response Format From SOLR Request!"),void t.send(502,"Bad Gateway");var n={response:{}};n.response.numFound=a.response.numFound,n.response.start=a.response.start,n.response.maxScore=a.response.maxScore;try{n.response.docs=r.map(a.response.docs,function(e){return{jobId:e.jobId,boxJobId:e.boxJobId,name:e.name,description:e.description,state:e.state,shared:e.shared,repairOrder:e.repairOrder,segment:e.repairSegment,createdTime:e.createdTime,lastModifiedTime:e.lastModifiedTime,models:JSON.parse(e.modelsJSON||"[]"),createdBy:JSON.parse(e.createdByJSON||"{}"),lastModifiedBy:JSON.parse(e.lastModifiedByJSON||"{}"),score:e.score}})}catch(e){return s.error("Error Parsing JSON From SOLR: ",e),void t.send(502,"Bad Gateway")}t.send(200,n)})})};module.exports=s}();