!function(){"use strict";var r=require("express"),o=require("underscore"),e=require("url"),s=function(s,t){var n=t.webServer,a=t.config,d=t.networkContext;n.post("/SAWeb/services/manuals/search-manuals",r.bodyParser(),function(r,o){var e={q:r.body.q,start:r.body.start||0,rows:r.body.rows||10,boxId:r.body.boxId,fq:r.body.fq};i(e,a.searchManualsUrl,r,o)}),n.post("/SAWeb/services/manuals/manuals-highlight",r.bodyParser(),function(r,o){var e={q:r.body.q,fq:r.body.fq,hl:r.body.hl,facet:r.body.facet,fl:r.body.fl,sort:r.body.sort,rows:r.body.rows||10,boxId:r.body.boxId};i(e,a.highlightManualsUrl,r,o)}),n.post("/SAWeb/services/manuals/highlight-in-manual",r.bodyParser(),function(r,o){var e={q:r.body.q,fq:r.body.fq};i(e,a.highlightInManualsUrl,r,o)}),n.post("/SAWeb/services/solution/search-solutions",r.bodyParser(),function(r,e){var s={q:r.body.q,start:r.body.start||0,rows:r.body.rows||10,fq:r.body.fq};o.isEmpty(r.body.boxId)||o.extend(s,{boxId:r.body.boxId}),i(s,a.searchSolutionsUrl,r,e)}),n.post("/SAWeb/services/solution/highlight-in-solution",r.bodyParser(),function(r,o){var e={q:r.body.q,fq:r.body.fq};i(e,a.highlightInSolutionsUrl,r,o)});var i=function(r,t,n,i){var l=e.format({protocol:a.protocol,hostname:a.hostname,port:a.port,pathname:t,query:r}),b={"Content-Type":"application/x-www-form-urlencoded",charset:"UTF-8",SOLR_USER:n.headers["x-user"]};d.post({url:l,headers:b},function(r,t){if(console.log("url**************************8",e),r)return s.error("Request To SOLR Failed: ",r),void i.send(500,"Internal Server Error.");try{var n=JSON.parse(t.body)}catch(r){return s.error("Error Parsing JSON: ",r),void i.send(500,"Internal Server Error.")}return n.error?(s.error("Error Received From SOLR Request: ",n.error.msg),void i.send(502,"Bad Gateway")):n.response&&o.isArray(n.response.docs)?void i.send(200,n):(s.error("Unexpected Response Format From SOLR Request!"),void i.send(502,n.response.docs))})}};module.exports=s}();