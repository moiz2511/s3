"use strict";var util=require("util"),events=require("events"),protocol=require("Protocol"),_=require("underscore"),StartupContext=require("./StartupContext"),Supervisor=function(t,e,r){var o=0,i=0,n=void 0,u=!1,l=void 0,a=function(){console.log("Attempting to start children. Attempt number: "+(i+1)),i+=1;var c=t();l=new StartupContext(c,e,r),l.start(function(t){t||i>1&&c.broadcast(protocol.boxRecovered,{startupCount:i,failureOccurredAfterStartup:u})}),l.on("childFailed",function(t){var r=new Date;n&&r-n>e.tolerableChildFailureFrequency?o=1:o+=1,n=r,!e.disableRestart&&o<e.tolerableChildFailureMaximum?a():console.log("Children failed to start "+o+" time(s) within the frequency tolerance. Halting."),u=t})};this.initialize=function(){a()},this.shutdown=function(){l&&l.shutdown(function(){console.log("Shut down successfully.")})}};module.exports=Supervisor;