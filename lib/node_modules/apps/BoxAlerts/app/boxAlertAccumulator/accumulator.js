!function(){"use strict";var e=require("underscore"),r=function(r,n){var t=[],i=n;i.getBoxAlerts(function(n,i){n&&(r.error(n),i=[]),i&&(t=e.union(t,i))}),this.saveAlert=function(e,n){n=n||function(){},t.push(e);var o=e.persistent||!1;o?i.saveBoxAlert(e,function(e){e&&r.error(e),n(e)}):n(null)},this.removeAlert=function(n,o){if(o=o||function(){},!n)return void o(new Error("Invalid Reference Id"));var u=e.find(t,function(e){return e.alertReferenceId===n});if(e.isEmpty(u))return void o(new Error("No alert found for given reference Id"));var l=function(r){t=e.reject(t,function(e){return e.alertReferenceId===n}),o(r)};return u.persistent?void i.deleteBoxAlert(n,function(e){e&&r.error(e),l(e)}):void l(null)},this.getAlerts=function(r){return e.chain(t).filter(function(n){return!n.isDelivered&&(!n.users||n.users&&e.contains(n.users,r))}).map(function(e){return{applicationId:e.applicationId,alertId:e.alertId,alertDetails:e.alertDetails||{}}}).value()},this.onAlertDelivered=function(n,o){if(o=o||function(){},!n)return void o(new Error("Invalid Reference Id"));var u=e.find(t,function(e){return e.alertReferenceId===n});return e.isEmpty(u)?void o(new Error("No alert found for given reference Id")):(u.isDelivered=!0,void(u.persistent?i.setBoxAlertAsDelivered(n,function(e){e&&r.error(e),o(e)}):o(null)))}};module.exports=r}();