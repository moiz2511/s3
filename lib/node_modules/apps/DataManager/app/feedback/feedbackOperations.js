"use strict";var config=require("../config"),environment=require("Environment"),url=require("url"),serverBaseUrl=url.parse(environment.serverLocation),feedbackCollection="Feedback",async=require("async"),_=require("underscore"),save=function(e,o,r){e.collection(feedbackCollection).insert(o,function(e){r(e)})},retrieve=function(e,o){e.collection(feedbackCollection).find({}).toArray(function(e,r){o(e,r)})},upload=function(e,o,r){retrieve(e,function(n,t){return n?void r(n):void async.each(t,function(r,n){var t=url.format({protocol:serverBaseUrl.protocol,hostname:serverBaseUrl.hostname,port:serverBaseUrl.port,pathname:config.feedbackURL}),i={url:t,headers:{"Content-Type":"application/vnd.johndeere.sa.uploadFeedBack.v1+json"},json:_.omit(r,"_id")};o.post(o.getNetworkOptions(i),function(o,t){return o?void n(o):200!==t.statusCode?(o=new Error("Invalid statusCode."),o.statusCode=t.statusCode,void n(o)):void remove(e,r,function(e){n(e)})})},function(e){r(e,t.length)})})},remove=function(e,o,r){e.collection(feedbackCollection).remove({_id:o._id},function(e){r(e)})};exports.save=save,exports.retrieve=retrieve,exports.upload=upload;