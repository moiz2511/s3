"use strict";var events=require("events"),http=require("http"),url=require("url"),box=require("BoxApplication"),netUtility=require("NetUtility"),server=require("Server"),frontEndServerClient=require("apps/FrontEndServer/Client"),async=require("async"),_=require("underscore"),registration=require("apps/Registration/Client"),config=require("./config.js"),app=box(config);app.setMaxListeners(25);var webServer=server.createServer(module,config,[]),httpServer=http.createServer(webServer),options={webServer:webServer,httpServer:httpServer,initializationEvents:new events.EventEmitter,registrationClient:registration.create(app)},fileList=["./init.js"],mountRoutes=function(e){var o=frontEndServerClient.create(app);o.addNamespace("/box"),frontEndServerClient.mount(app,httpServer,function(o){var s={};o("/SAWeb/services/boxes",{allowUnauthorized:!0,allowLowSpace:!0,corsOptions:s}),o("/SAWeb/services/boxes/",{allowUnauthorized:!0,allowLowSpace:!0,corsOptions:s}),o("/SAWeb/services/boxes/*",{allowUnauthorized:!0,allowLowSpace:!0,corsOptions:s}),o("/box/services/box",{noSession:!0,allowUnauthorized:!0,allowLowSpace:!0,corsOptions:s}),o("/box/services/box/",{noSession:!0,allowUnauthorized:!0,allowLowSpace:!0,corsOptions:s}),o("/box/services/box/*",{noSession:!0,allowUnauthorized:!0,allowLowSpace:!0,corsOptions:s}),o("/SAWeb/services/boxes/controllersoftwareupdates/:pin",{noSession:!0,allowUnauthorized:!0,allowLowSpace:!0,corsOptions:s}),o("/SAWeb/services/fileServer/:applicationLanguage",{noSession:!0,allowUnauthorized:!0,allowLowSpace:!0,corsOptions:s}),o("/SAWeb/services/boxes/getPayloads",{noSession:!0,allowUnauthorized:!0,allowLowSpace:!0,corsOptions:s}),o("/SAWeb/services/boxes/deletePayload",{noSession:!0,allowUnauthorized:!0,allowLowSpace:!0,corsOptions:s}),o("/SAWeb/services/boxes/sdaUpdates/updateSda",{noSession:!0,allowUnauthorized:!0,corsOptions:s}),o("/SAWeb/services/dataFencing/modelList/*",{corsOptions:s}),o("/SAWeb/services/PINService/PINSearch",{corsOptions:s}),o("/SAWeb/controllersoftwareupdates/*",{noSession:!0,allowUnauthorized:!0,corsOptions:s}),o("/SAWeb/services/boxes/sdaUpdates/updateSda",{noSession:!0,allowUnauthorized:!0,corsOptions:s}),o("/SAWeb/services/boxes/deleteSDA",{noSession:!0,allowUnauthorized:!0,corsOptions:s}),o("/SAWeb/services/languagelists/*",{corsOptions:s}),o("/SAWeb/services/dataFencing/requiredManualLanguage",{corsOptions:s}),o("/SAWeb/services/ActivityList",{corsOptions:s}),o("/SAWeb/services/activity/*",{corsOptions:s}),o("/SAWeb/services/logService",{corsOptions:s}),o("/SAWeb/services/logService/",{corsOptions:s}),o("/SAWeb/services/logService/*",{corsOptions:s}),o("/SAWeb/services/jobs",{corsOptions:s}),o("/SAWeb/services/jobs/",{corsOptions:s}),o("/SAWeb/services/jobs/*",{corsOptions:s}),o("/SAWeb/services/dealer/locations",{corsOptions:s}),o("/SAWeb/services/models/*",{corsOptions:s}),o("/SAWeb/services/datasets/*",{allowUnauthorized:!0,corsOptions:s}),o("/SAWeb/services/donorecudetails",{noSession:!0,allowUnauthorized:!0,corsOptions:s}),o("/SAWeb/services/donorecudetails/",{noSession:!0,allowUnauthorized:!0,corsOptions:s}),o("/SAWeb/services/donorecudetails/*",{noSession:!0,allowUnauthorized:!0,corsOptions:s}),o("/payloads/*",{noSession:!0,allowUnauthorized:!0,allowLowSpace:!0,corsOptions:{headers:" X-HybridSession, X-Request-Id, X-File-Size-Kb, Content-Type"}}),e()})};netUtility.createNetworkContext(options.registrationClient,function(e){options.networkContext=e,async.each(fileList,function(e,o){options.onReady=_.once(function(e){o(e)}),app.use(e,module,options)},function(e){e?(app.error(e),process.exit(1)):mountRoutes(function(){app.ready()})}),app.on("start",function(){options.initializationEvents.emit("start")}),app.on("stop",function(){e.stop(),httpServer.close(),app.disconnect(),options.database.close()})}),process.on("SIGINT",function(){});