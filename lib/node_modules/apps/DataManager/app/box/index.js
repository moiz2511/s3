"use strict";var createBoxInformationObject=require("./createBoxInformationObject.js"),routes=require("./routes.js"),async=require("async"),setupStateUtils=require("./setupStateUtils.js"),syncUtils=require("../databaseManagement/syncManagement/utils.js"),setup=function(t,e){var n=e.onReady;async.series([function(n){createBoxInformationObject(t,e.database,n)},function(n){routes(t,e,n)},function(n){setupStateUtils.onceConnectedAndSetupStartOver(e.connectorClient,e.registrationClient,function(){function n(){t.info('Requesting change from "StartOver" to "Setup"'),setupStateUtils.changeStateFromSetupStartOver(e.registrationClient,e.registrationClient.isSetupStartOver,e.registrationClient.getIsSetupState,function(a){a?(t.error(a),t.info('Failed to transition from "SetupStartOver" to "Setup". We will remain in "SetupStartOver" state until next quick sync'),syncUtils.onAnyQuickSyncComplete(e.databaseManager,n)):t.info('Successfully changed from "StartOver" to "Setup"')})}syncUtils.quickSyncWithCallback(e.databaseManager,function(a){a?(t.error(a),t.info('Failed to do a quick sync. We will remain in "SetupStartOver" state until next quick sync'),syncUtils.onAnyQuickSyncComplete(e.databaseManager,n)):n()})}),n()}],function(t){n(t)})};module.exports=setup;