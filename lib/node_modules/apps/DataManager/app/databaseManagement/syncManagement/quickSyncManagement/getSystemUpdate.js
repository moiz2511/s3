"use strict";var async=require("async"),_=require("underscore");module.exports.getSystemUpdate=function(e,t,n,r){var o=t.newSoftwareVersion;return!o||_.isEmpty(t.newSoftwareUpdate)?void _.defer(function(){r(void 0,t,n)}):void async.waterfall([function(t){e._dbHelper.getSoftwareUpdate(t)},function(n,r){!n||n.installedVersion===o||n.newVersion&&n.newVersion===o?_.defer(function(){r()}):e._serverHelper.downloadSoftwareUpdate(t.newSoftwareUpdate,o,function(n){return n?void r(n):void e._systemUpdateInstallerClient.newSoftwareUpdate(o,t.softwareUpdateCritical,function(e){r(e)})})}],function(e){r(e,t,n)})};