var manifestName="manifest.gz",environment=require("Environment"),async=require("async"),_=require("underscore"),path=require("path"),fs=require("fs"),mkdirp=require("mkdirp");exports.copyManifests=function(e,n,i,t){i.eachManifest(function(i,t,a,r){var o=path.join(environment.manifestsPath,i),s=path.join(n,t);async.series([function(e){mkdirp(o,function(n){n&&"EEXIST"===n.code&&(n=void 0),e(n)})},function(n){e.copySingleFile(path.join(s,a),path.join(o,manifestName),function(e){n(e)})}],function(e){r(e)})},function(e){t(e)})},exports.readManifest=function(e,n,i){e.readPossiblyGzippedFile(path.join(environment.manifestsPath,n,manifestName),function(e,n){try{var t=JSON.parse(n.toString("utf8"));_.isArray(t.models)&&(t.models=_.object(_.pluck(t.models,"modelGUID"),t.models))}catch(e){var a=e}i(e||a,t)})},exports.checkManifestExists=function(e,n,i){try{var t=path.join(environment.manifestsPath,n,manifestName)}catch(e){return void i(!1)}e.readPossiblyGzippedFile(t,function(e,n){i(e||!n?!1:!0)})};