"use strict";var _=require("underscore"),async=require("async"),uuid=require("uuid-v4"),User=function(e,t){this._app=e,this._db=t};User.prototype.getCollection=function(){return"Users"},User.prototype.getType=function(){return"User"},User.prototype.validateNewData=function(e,t){t(new Error("Users cannot be added locally."))},User.prototype.validateUpdate=function(e,t,r){r(new Error("Users cannot be updated locally."))},User.prototype.compactData=function(e,t,r){return e||_.isArray(t)&&0!==t.length?void r(void 0,e):void r(new Error("No data to compact."))},User.prototype.applyQuery=function(e,t,r){if(!t)return void r();if(t.allUsers)return void r(void 0,e);if(!t.userIds)return void r();var o=_.map(t.userIds,function(e){return e.toUpperCase()}),a=_.map(o,function(t){return _.findWhere(e,{localId:t})});r(void 0,a)},User.prototype.formatUploadBoxStateMessage=function(e,t){t()},User.prototype.createUpdates=function(e,t,r,o){var a=t.boxUsers||[];_.each(a,function(e){r(void 0,{type:e.action,data:_.omit(e,"action")})}),o()},User.prototype.processUpdatesDuringSync=function(e,t,r,o,a){return 0===e.length?void a():void async.each(e,function(e,a){switch(e.updateData.type){case"add":var n=e.updateData.data;n.localId=n.userId.toUpperCase(),n.id=n.localId,delete n.userId,t(n,function(t){o(e._id,t,a)});break;case"delete":r(e.updateData.data.userId,function(t){o(e._id,t,a)})}},function(e){a(e)})},User.prototype.processUpdatesAfterSync=function(){},module.exports=User;