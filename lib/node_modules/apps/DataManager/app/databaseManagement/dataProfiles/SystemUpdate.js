"use strict";var _=require("underscore"),async=require("async"),SystemUpdate=function(t,e,n){this._systemUpdateProvider=n,this._app=t,this._database=e};SystemUpdate.prototype.getCollection=function(){return"SystemUpdate"},SystemUpdate.prototype.getType=function(){return"SystemUpdate"},SystemUpdate.prototype.validateNewData=function(t,e){e(new Error("SystemUpdate cannot be added locally."))},SystemUpdate.prototype.validateUpdate=function(t,e,n){onComplete()},SystemUpdate.prototype.compactData=function(t,e,n){onComplete()},SystemUpdate.prototype.applyQuery=function(t,e,n){n()},SystemUpdate.prototype.formatUploadBoxStateMessage=function(t,e){var n=this;async.parallel({installationSummaries:function(t){n._systemUpdateProvider.retrieveInstallationSummaries(function(e,i){e?t(e):n._systemUpdateProvider.clearInstallationSummaries(function(e){if(e)t(e);else{var n=_.chain(i).map(function(t){return{installedVersion:t.installedVersion,installationDisposition:t.installationDisposition,installationStartTime:t.installationStartTime,installationCompletionTime:t.installationCompletionTime,installationInitiatedBy:t.installationInitiatedBy}}).value();t(e,n)}})})},installedVersion:function(t){n._systemUpdateProvider.getInstalledSoftwareVersion(function(e,n){t(e,n)})},pendingInstallationVersion:function(t){n._systemUpdateProvider.getPendingSystemUpdate(function(e,n){t(e,n&&n.newVersion)})}},function(t,n){if(t)return void e(t);var i=_.omit({installedVersion:n.installedVersion,newVersion:n.pendingInstallationVersion},function(t){return _.isUndefined(t)||_.isNull(t)}),a=_.extend({systemSoftware:i},n.installationSummaries);e(void 0,a)})},SystemUpdate.prototype.createUpdates=function(t,e,n,i){i()},SystemUpdate.prototype.processUpdatesDuringSync=function(t,e,n,i,a){a()},module.exports=SystemUpdate;