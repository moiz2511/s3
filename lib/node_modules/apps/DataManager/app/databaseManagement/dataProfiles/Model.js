"use strict";var _=require("underscore"),async=require("async"),Model=function(t,e){this._app=t,this._db=e};Model.prototype.getCollection=function(){return"Models"},Model.prototype.getType=function(){return"Model"},Model.prototype.validateNewData=function(t,e){e(new Error("Models cannot be added locally."))},Model.prototype.validateUpdate=function(t,e,o){o(new Error("Models cannot be updated locally."))},Model.prototype.compactData=function(t,e,o){return t||_.isArray(e)&&0!==e.length?void o(void 0,t):void o(new Error("No data to compact."))},Model.prototype.applyQuery=function(t,e,o){var n=_.reject(t,function(t){return e.dataFencingGroups?_.isEmpty(_.intersection(t.dataFencingGroups,e.dataFencingGroups)):e.userDataFencingGroups&&e.lastLoggedInDataFencingGroups?_.isEmpty(_.intersection(t.dataFencingGroups,e.userDataFencingGroups))||_.isEmpty(_.intersection(t.dataFencingGroups,e.lastLoggedInDataFencingGroups)):void 0}),a=e.pinPrefix;if(a){var r=function(t){return _.every(t,function(t,e){return t===a[e]||"?"===t||" "===t})};n=_.filter(n,function(t){return _.any(t.pinPrefix,r)})}o(void 0,n)},Model.prototype.formatUploadBoxStateMessage=function(t,e){e()},Model.prototype.createUpdates=function(t,e,o,n){var a=this,r=e.models,i=r&&r.adds;return _.isEmpty(i)?void n():void async.map(i,function(t,e){a._db.collection("Models").findOne({id:t.mG},function(o,n){var a=n&&n.hasData||!1;t=_.clone(t),t.localId=t.mG,t.id=t.mG,delete t.mG,t.hasData=a,e(null,t)})},function(t,e){e.length>0&&o(void 0,{type:"add",data:e}),n()})},Model.prototype.processUpdatesDuringSync=function(t,e,o,n,a){async.each(t,function(t,o){switch(t.updateData.type){case"add":e(t.updateData.data,function(e){n(t._id,e,o)})}},function(t){a(t)})},Model.prototype.processUpdatesAfterSync=function(){},module.exports=Model;