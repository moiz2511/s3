"use strict";var _=require("underscore"),async=require("async"),uuid=require("uuid-v4"),documentId="DatasetsDocument",Datasets=function(t,a){this._app=t,this._db=a};Datasets.prototype.getCollection=function(){return"Datasets"},Datasets.prototype.getType=function(){return"Dataset"},Datasets.prototype.validateNewData=function(t,a){a(new Error("Datasets cannot be added locally."))},Datasets.prototype.validateUpdate=function(t,a,e){e(new Error("Datasets cannot be updated locally."))},Datasets.prototype.compactData=function(t,a,e){return t||_.isArray(a)&&0!==a.length?void e(void 0,t):void e(new Error("No data to compact."))},Datasets.prototype.applyQuery=function(t,a,e){e(void 0,_.findWhere(t,{localId:documentId}))},Datasets.prototype.formatUploadBoxStateMessage=function(t,a){a()},Datasets.prototype.createUpdates=function(t,a,e,o){var n=a.datasets;n&&e(void 0,{type:"add",data:n}),o()},Datasets.prototype.processUpdatesDuringSync=function(t,a,e,o,n){var s=this;return 0===t.length?void n():void async.each(t,function(t,e){switch(t.updateData.type){case"add":s._db.collection(s.getCollection()).findOne({localId:documentId},function(n,s){var d=t.updateData.data,r=s.datasets||[],c=_.unique(d.concat(r),function(t){return t.id}),i={datasets:c,id:documentId};a(i,function(a){o(t._id,a,e)})});break;default:e(new Error("Invalid update type."))}},function(t){n(t)})},module.exports=Datasets;