"use strict";var _=require("underscore"),async=require("async"),RecordingDetails=function(e,t){this._app=e,this._db=t};RecordingDetails.prototype.getCollection=function(){return"RecordingDetails"},RecordingDetails.prototype.getType=function(){return"RecordingDetails"},RecordingDetails.prototype.validateNewData=function(e,t){t(void 0,_.clone(e))},RecordingDetails.prototype.validateUpdate=function(e,t,o){o(new Error("RecordingDetails objects cannot be updated."))},RecordingDetails.prototype.compactData=function(e,t,o){return e||_.isArray(t)&&0!==t.length?void o(void 0,e||_.first(t)&&_.first(t).dataObject):void o(new Error("No data to compact."))},RecordingDetails.prototype.applyQuery=function(e,t,o){o(void 0,_.where(e,t))},RecordingDetails.prototype.formatUploadBoxStateMessage=function(e,t){var o=_.chain(e).where({type:"RecordingDetails"}).map(function(e){var t=_.clone(e.dataObject);return t.boxRecordingDetailsId=t.localId,delete t.localId,t}).value();t(null,o.length>0?{recordingDetails:o}:void 0)},RecordingDetails.prototype.createUpdates=function(e,t,o,i){_.isArray(e)&&e.length>0&&o(_.pluck(e,"index"));var a=t.recordingDetails;_.each(a,function(e){o(void 0,{type:"update",data:e})}),i()},RecordingDetails.prototype.processUpdatesDuringSync=function(e,t,o,i,a){return _.isEmpty(e)?void a():void async.each(e,function(e,o){if(!e.updateData&&e.completed===!1)return void i(e._id,void 0,o);if(e.completed===!0)return void o();switch(e.updateData.type){case"update":delete e.updateData.data.action,t(transformIds(e.updateData.data),function(t){i(e._id,t,o)});break;default:o(new Error("Invalid Type: "+e.updateData.type))}},function(e){a(e)})};var transformIds=function(e){if(e)return e.localId=e.boxRecordingDetailsId||e.recordingDetailsId,e.id=e.recordingDetailsId,_.omit(e,["boxRecordingDetailsId","recordingDetailsId"])};module.exports=RecordingDetails;