"use strict";var express=require("express"),acceptsCheck=require("Middleware/acceptsCheck.js"),_=require("underscore"),async=require("async"),ActivityProvider=require("../dataProviders/ActivityProvider.js"),setup=function(t,e){var s=e.webServer,i=new ActivityProvider(t,e.databaseManager,e.database,e.registrationClient);s.post("/SAWeb/services/ActivityList",express.json(),acceptsCheck("application/vnd.johndeere.sa.getPINActivityList.v1+json","application/json"),function(t,e){return t.body&&t.body.context?void i.getActivities(t.body,function(t,s){return t||!s?void e.status(t&&t.statusCode||500).end():void e.status(200).json(s)},t):void e.status(400).end()}),s.put("/SAWeb/services/activity/:activityId",express.json(),acceptsCheck("application/vnd.johndeere.sa.activity.v1+json"),function(e,s){var a=e.params.activityId,n=e.body.jobId,r=e.body.revisionId,d=e.headers["x-user"];i.updateActivityJobId(a,n,r,d,function(e,i){e&&"Invalid UserId"===e.message?s.status(403).end():e?(s.status(e.statusCode||500).end(),t.error("Internal Server Error while updating activity. ",e)):i?s.json(i).end():s.status(204).end()},e)}),s.post("/SAWeb/services/activity/:activityId/note",express.json({strict:!1}),acceptsCheck("application/vnd.johndeere.sa.activity.v1+json"),function(e,s){var a=e.params.activityId,n=e.body,r=e.headers["x-user"];return _.isString(n)?void i.addActivityNote(a,n,r,function(e,i){if(e&&"Invalid UserId"===e.message)s.status(403).end();else if(e)return s.status(e.statusCode||500).end(),void t.error("Internal Server Error while updating activity. ",e);var a=i&&i.activity,n=i&&i.noteId;a?s.status(200).json({noteId:n,updatedActivity:a}):s.status(404).end()},e):void s.status(400).end()}),s.put("/SAWeb/services/activity/:activityId/note/:noteId",express.json({strict:!1}),acceptsCheck("application/vnd.johndeere.sa.updateActivityNoteResponse.v1+json"),function(t,e){var s=t.params.activityId,a=t.params.noteId,n=t.body,r=t.headers["x-user"];return _.isString(n)?void i.updateActivityNote(s,a,n,r,function(t,s){if(t&&"Invalid UserId"===t.message)e.status(403).end();else if(t)return void e.status(t.statusCode||500).end();s?e.status(200).json(s):e.status(404).end()},t):void e.status(400).end()}),s.delete("/SAWeb/services/activity/:activityId/note/:noteId",express.json(),acceptsCheck("application/vnd.johndeere.sa.activity.v1+json"),function(t,e){var s=t.params.activityId,a=t.params.noteId,n=t.headers["x-user"];i.removeActivityNote(s,a,n,function(t,s){if(t&&"Invalid UserId"===t.message)e.status(403).end();else if(t)return void e.status(t.statusCode||500).end();s?e.status(200).json(s):e.status(404).end()},t)}),e.onReady()};module.exports=setup;