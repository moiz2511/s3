"use strict";var webSocketHelper=require("./webSocketHelper.js"),async=require("async"),_=require("underscore"),ONEManager=function(e,t){var n=this;this._disabled=!1,this._sendMessage=function(e,t){n._disabled||n._wsHelper.sendMessage(e,t)},async.series([function(t){n._wsHelper=new webSocketHelper(e,t).on("error",function(t){e.error("Error from ONE Client: ",t)})}],function(e){t(e)})};ONEManager.prototype.showCalculatingSize=function(){this._sendMessage("calculatingDataSize")},ONEManager.prototype.requestUserConfirmation=function(e,t,n,o,a,s,r){this._sendMessage("displayDataSize",{sizeInKB:e,deleteSizeInKB:t,freeSpaceInKB:n,copyLocation:o,canChange:a,errorCode:r||0})},ONEManager.prototype.promptForDatasetLocation=function(e,t){this._sendMessage("promptForDataCopy",{unfinishedDatasets:e,completedDatasets:t})},ONEManager.prototype.sendChangeDataLocationRequest=function(e){this._sendMessage("promptToChangeDataLocation",{path:e})},ONEManager.prototype.sendCopyProgress=function(e,t,n){this._sendMessage("copyUpdateProgress",{dataCopiedInKB:e,sizeInKB:t,timeRemainingInSeconds:n<60?60:n})},ONEManager.prototype.sendSyncProgress=function(e,t,n,o,a){this._sendMessage("syncUpdateProgress",{syncedItems:e,totalItems:t,timeRemainingInSeconds:o<60?60:o,showDialog:n,forDataCopy:a})},ONEManager.prototype.sendCopyCompleteMessage=function(){this._sendMessage("copyComplete")},ONEManager.prototype.sendSyncCompleteMessage=function(){this._sendMessage("syncComplete")},ONEManager.prototype.sendCancelMessage=function(){this._sendMessage("cancel")},ONEManager.prototype._sendErrorMessageWithCode=function(e){this._sendMessage("error",{code:e})},ONEManager.prototype.sendCopyErrorMessage=function(){this._sendErrorMessageWithCode(0)},ONEManager.prototype.sendSyncErrorMessage=function(e){var t;switch(e){case"Box Unauthorized":t=4;break;case"destinationLocationNotPresent":t=3;break;default:t=1}this._sendErrorMessageWithCode(t)},ONEManager.prototype.sendSyncPausedMessage=function(e){this._sendMessage("pauseSync",{paused:e?1:0})},ONEManager.prototype.sendNoSpaceErrorMessage=function(){this._sendErrorMessageWithCode(2),this._disabled=!0},ONEManager.prototype.onNextDataSetSelected=function(e){this._wsHelper.once("dataSetSelected",e)},ONEManager.prototype.offNextDataSetSelected=function(e){this._wsHelper.removeListener("dataSetSelected",e)},ONEManager.prototype.onNextStartCopy=function(e){this._wsHelper.once("copy",e)},ONEManager.prototype.offNextStartCopy=function(e){this._wsHelper.removeListener("copy",e)},ONEManager.prototype.onRetrySync=function(e){this._wsHelper.on("retrySync",e)},ONEManager.prototype.onCancelCopy=function(e){this._wsHelper.on("cancel",e)},ONEManager.prototype.onNextCancelCopy=function(e){this._wsHelper.once("cancel",e)},ONEManager.prototype.offNextCancelCopy=function(e){this._wsHelper.removeListener("cancel",e)},ONEManager.prototype.onRequestLocationValidation=function(e){this._wsHelper.on("requestLocationValidation",e)},ONEManager.prototype.offRequestLocationValidation=function(e){this._wsHelper.removeListener("requestLocationValidation",e)},ONEManager.prototype.onChangeDataLocation=function(e){this._wsHelper.on("changeDataLocation",e)},ONEManager.prototype.installPdfCertificate=function(e,t){var n={path:e,password:t};this._wsHelper.sendMessage("installPdfCertificate",n)},ONEManager.prototype.unInstallPdfCertificates=function(){this._wsHelper.sendMessage("unInstallPdfCertificates")},ONEManager.prototype.onTrimData=function(e){this._wsHelper.on("OnReprogrammingTrimOptionsCompleted",e)},ONEManager.prototype.offTrimData=function(e){this._wsHelper.removeListener("OnReprogrammingTrimOptionsCompleted",e)},ONEManager.prototype.sendTrimData=function(e,t){var n={propertyFilePath:e};this._wsHelper.sendMessage("displayReprogrammingTrimOptions",n)},ONEManager.prototype.onGSixData=function(e){this._wsHelper.on("OnInvokeExecutableCompleted",e)},ONEManager.prototype.offGSixData=function(e){this._wsHelper.removeListener("OnInvokeExecutableCompleted",e)},ONEManager.prototype.onEXEInvokeCall=function(e){this._wsHelper.on("OnInvokeExecutableCompleted",e)},ONEManager.prototype.offEXEInvokeCall=function(e){this._wsHelper.removeListener("OnInvokeExecutableCompleted",e)},ONEManager.prototype.sendGSixData=function(e,t,n){var o={exePath:e,cmdLineArgs:t};this._wsHelper.sendMessage("invokeExecutable",o)},ONEManager.prototype.invokeApp=function(e,t){var n={exePath:e,cmdLineArgs:t};this._wsHelper.sendMessage("invokeExecutable",n)},ONEManager.prototype.onBoxRecovered=function(){this._wsHelper.sendMessage("crashed")},ONEManager.prototype.onSendCrashDetails=function(e){this._wsHelper.on("sendCrashDetails",e)},ONEManager.prototype.offSendCrashDetails=function(e){this._wsHelper.removeListener("sendCrashDetails",e)},module.exports=ONEManager;