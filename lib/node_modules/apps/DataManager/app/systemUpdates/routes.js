"use strict";var SystemUpdateProvider=require("../dataProviders/SystemUpdateProvider.js"),environment=require("Environment"),path=require("path"),fs=require("fs"),setup=function(e,t,n){var a=t.webServer,r=new SystemUpdateProvider(e,t.database,t.systemUpdateInstallerClient);a.get("/SAWeb/services/boxes/:id/checkSoftwareUpdate",function(t,n){r.getAvailableSoftwareVersion(function(t,a){if(t||!a)n.send(500);else if(a){var r=path.join(environment.updateStagingPath,a,environment.updateFileName);try{fs.exists(r,function(e){e?n.send(200):n.send(500)})}catch(t){e.error("error in downloading a file",t),n.send(500)}}})}),a.get("/SAWeb/services/boxes/:id/getSoftwareUpdate",function(t,n){r.setSoftwareDownload(t.headers["x-user"],function(t,a){if(t)n.send("Software Update download failed.");else if(a){var r=path.join(environment.updateStagingPath,a,environment.updateFileName);n.download(r,environment.updateFileName,function(t){t?(e.error("error in downloading a file",t),n.send("Software Update download failed.")):e.info("Software Update downloaded successfully.")})}else n.send("Software Update download failed.")})}),n()};module.exports=setup;