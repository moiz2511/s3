"use strict";var _=require("underscore"),path=require("path"),async=require("async"),environment=require("Environment"),BoxDataProvider=function(t,e,a){var n=this;n._app=t,n._online=!1,n._installedVersion="",n._dbManager=e,n._configStoreClient=a,n._documentId="BoxInformationDocument",_getLastQuickSyncTime(a,function(t){t||n._dbManager.getDataById("BoxInformation",n._documentId,function(t,e){e&&(e.lastDataSyncTime&&n.setLastFullSyncTime(new Date(e.lastDataSyncTime)),e.lastQuickSyncTime&&n.setLastQuickSyncTime(new Date(e.lastQuickSyncTime)))})})};BoxDataProvider.prototype.getBoxInformation=function(t){var e=this;e._dbManager.getDataById("BoxInformation",e._documentId,function(e,a){if(e)return void t(e);if(!a)return void t(void 0,{});var n={};n.savedUpdateProfile={syncFrequency:a.syncFrequency,customSyncFrequency:a.customSyncFrequency,models:a.incrementalUpdateModels,nextScheduledDataSync:a.nextScheduledDataSync},n.setupDataProperties={languages:a.setupLanguages||[],locations:a.setupLocations||[],datasets:a.setupDatasets||[],models:a.setupModels||[]},n.savedDataProperties={languages:a.languages||[],locations:a.locationIds||[],datasets:a.datasets||[],models:a.models||[]},n.datasetMetadata=a.datasetMetadata,n.lastModifiedBy=a.lastModifiedBy,n.lastModifiedTime=a.lastModifiedTime,n.boxType=a.boxType,n.newModels=a.newModels||[],n.selectedDatasetContracts=a.selectedDatasetContracts||[],n.selectedDatasetVersion=a.selectedDatasetVersion,t(void 0,n)})},BoxDataProvider.prototype.updateBoxInformation=function(t,e){var a=this;a._dbManager.updateData("BoxInformation",a._documentId,t,e)},BoxDataProvider.prototype.updateBoxInformationAndSync=function(t,e,a){var n=this;_.isUndefined(a)&&(a=e,e=void 0),this.updateBoxInformation(t,function(t,o){return t?void a(t):(n._dbManager.startQuickSync(e),void a(void 0,o))})},BoxDataProvider.prototype.getLastFullSyncTime=function(t){this._configStoreClient.getParameter("lastDataSyncTime",function(e){t(e)})},BoxDataProvider.prototype.setLastFullSyncTime=function(t){var e=this;_.isDate(t)&&e._configStoreClient.setParameter("lastDataSyncTime",t,function(t){e._configStoreClient.setParameter("completedSetup",!0,function(){})})};var _getLastQuickSyncTime=function(t,e){t.getParameter("lastQuickSyncTime",function(t){e(t)})};BoxDataProvider.prototype.setLastQuickSyncTime=function(t){var e=this;_.isDate(t)&&e._configStoreClient.setParameter("lastQuickSyncTime",t,function(t){e._configStoreClient.setParameter("completedFirstSync",!0,function(){})})},module.exports=BoxDataProvider;