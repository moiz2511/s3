"use strict";var _=require("underscore"),async=require("async"),ActivityProvider=require("./ActivityProvider.js"),DiagnosticProcedureDetailProvider=function(e,t,i,o){var r="executedDiagProc",a=new ActivityProvider(e,t,i,o),n=function(e){return e.boxDiagProcDetailId=e.localId,delete e.localId,delete e.id,e},c=function(e,t){return _.extend(new Error(t),{statusCode:e})};this.get=function(e,i){t.getDataById("DiagnosticProcedureDetail",e,function(e,t){return e?void i(e):t?void i(null,n(t)):void i(c(404))})},this.getNewestDiagProcDetailIdObjects=function(e,i){t.getDataByQuery("DiagnosticProcedureDetail",{newest:!0,idsOnly:!0,jobIds:e},i)};var d=function(e,t,i){var o=_.extend(_.pick(t,["manualId","topicId","manualTitle","topicTitle","procedureId","boxDiagProcDetailId","jobId"]),{type:r});a.addActivity(o,e,i)},u=function(e,i,o){t.addData("DiagnosticProcedureDetail",_.extend(e,{jobId:i,createdTime:new Date}),function(e,t){t&&(t=n(t)),o(e,t)})};this.add=function(t,i,o,r){o.topicTitle=o.topicName,o.manualTitle=o.manualName,o=_.omit(o,"topicName","manualName"),u(o,t,function(t,o){return t?void r(t):void d(i,o,function(t){t&&e.error("DiagnosticProcedureDetailProvider: Failed to create activity"),r(t,o)})})},this.update=function(e,i,o,r){t.updateData("DiagnosticProcedureDetail",i,o,function(e,i){return e?void r(e):(t.startQuickSync(),void r(void 0,i))})}};module.exports=DiagnosticProcedureDetailProvider;