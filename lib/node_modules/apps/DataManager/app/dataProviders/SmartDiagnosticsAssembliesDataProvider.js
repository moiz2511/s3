"use strict";var _=require("underscore"),fs=require("fs"),path=require("path"),SmartDiagnosticsAssembliesDataProvider=function(i,e){this.db=e,SmartDiagnosticsAssembliesDataProvider.prototype.getSdaFileData=function(i){var e=this.db;e.collection("SmartDiagnosticsAssemblies").find({},{sdaFileName:1,dateModified:1,_id:!1}).toArray(function(e,t){return e?void i(e,null):void i(e,t)})},SmartDiagnosticsAssembliesDataProvider.prototype.getSdaFiles=function(i,e){var t=this.db;t.collection("SmartDiagnosticsAssemblies").find({},{_id:!1}).toArray(function(i,t){return i?void e(i,null):void e(i,t)})},SmartDiagnosticsAssembliesDataProvider.prototype.addSdaFileInDB=function(e,t){var s=this.db;if(e&&0==e.length)return void t();var r=_.after(e.length,function(){t()});_.each(e,function(e){s.collection("SmartDiagnosticsAssemblies").find({sdaFileName:e.payloadFileName},{_id:!1}).toArray(function(t,o){t&&r(),o.length>0?s.collection("SmartDiagnosticsAssemblies").remove({sdaFileName:e.sdaFileName},function(t){t?i.error(t):s.collection("SmartDiagnosticsAssemblies").insert(e,function(e){return e?(i.error(e),void r()):void r()})}):s.collection("SmartDiagnosticsAssemblies").insert(e,function(e){return e?(i.error(e),void r()):void r()})})})},SmartDiagnosticsAssembliesDataProvider.prototype.deleteSdaFileFromDB=function(e,t){var s=this.db;if(e&&0==e.length)return void t();var r=_.after(e.length,function(){t()});_.each(e,function(e){s.collection("SmartDiagnosticsAssemblies").find({sdaFileName:e.fileName},{_id:!1}).toArray(function(t,o){t&&r(),o.length>0&&s.collection("SmartDiagnosticsAssemblies").remove({sdaFileName:e.fileName},function(e){return e?(i.error("Error while deleting SmartDiagnosticsAssemblies",e),void r()):void r()})})})}};module.exports=SmartDiagnosticsAssembliesDataProvider;