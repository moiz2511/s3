"use strict";var _=require("underscore"),UsersDataProvider=function(e,r,t){this._app=e,this._dbManager=r,this._registrationClient=t};UsersDataProvider.prototype.getUsers=function(e){this._dbManager.getDataByQuery("User",{allUsers:!0},function(r,t){t=_.map(t,function(e){return{userId:e.localId,userName:e.userName}}),e(r,t)})},UsersDataProvider.prototype.getUsersDataFencingGroups=function(e,r){this.getFullUserObjectAndLastLoggedInUserObject(e,function(e,t,s){r(e,t&&t.dataFencingGroups,s&&s.dataFencingGroups)})},UsersDataProvider.prototype.getFullUserObjects=function(e,r){var t=this._app,s=this._dbManager;e=_.map(e,function(e){return e&&e.toUpperCase()}),s.getDataByQuery("User",{userIds:e},function(s,o){if(s){var n="Error attempting to query Users. "+s;return t.error(n),void r(new Error(n))}if(!o||_.contains(o,void 0)){var n="Invalid user: "+e;return t.error(n),void r(new Error(n))}r(void 0,_.map(o,function(e){return e.userId=e.localId,_.omit(e,"localId","id")}))})},UsersDataProvider.prototype.getFullUserObject=function(e,r){var t=this;t.getFullUserObjects([e],function(e,t){r(e,_.first(t))})},UsersDataProvider.prototype.getFullUserObjectAndLastLoggedInUserObject=function(e,r){var t=this;t._registrationClient.getLastLoggedInUser(function(s){t.getFullUserObjects([e,s],function(e,t){return e||!_.isArray(t)||2!==t.length?void r(e):void r(void 0,t[0],t[1])})})},UsersDataProvider.prototype.getUserObject=function(e,r){this.getFullUserObject(e,function(e,t){r(e,_.pick(t,"userId","userName"))})},UsersDataProvider.prototype.getECUAccessLevel=function(e,r){this.getFullUserObject(e,function(e,t){r(void 0,t&&t.ecuAccessLevel)})},UsersDataProvider.prototype.getUserAuthorizedModules=function(e,r){this.getFullUserObject(e,function(e,t){r(e,t&&t.samodules)})},module.exports=UsersDataProvider;