!function(){var r=require("underscore"),e=require("FileUtility"),o=require("xml2js"),i=new o.Parser({mergeAttrs:!0}),t=function(o,t){var n={};this.loadProcedures=function(n,d){o.info("Attempting to load procedures file: "+n),e.getFileBuffer(n,t,function(e,t){return e?(o.error("Failed to load procedures file: "+e.message),void d(e)):r.isEmpty(t)?(e=new Error("Empty procedure file"),o.error("Empty procedure file",e),void d(e)):(o.info("Successfully loaded the procedures file: "+n),void i.parseString(t.toString("utf8"),function(r,e){return r?(o.error("Failed to parse through procedures file",r),void d(r)):e?e.procedureDetails?(o.info("Successfully parsed through procedures file: "+n),void u(e,d)):void d(new Error("Encountered missing object property values after parsing through procedures data")):(r=new Error("No data in procedure file"),o.error("Parsing the procedure file returned no data",r),void d(r))}))})},this.getProcedure=function(r){return n[r]},this.getProcedures=function(){return n},this.clearProcedures=function(){n={}};var u=function(e,i){var t={},u=e.procedureDetails.procedure;r.each(u,function(e){e.id&&e.workflowId||o.error("Encountered missing object property values while building procedures index");var i=r.first(e.id);if(t[i]={workflowId:r.first(e.workflowId),id:i},e.controller){var n=r.first(e.controller);t[i].controller={id:r.first(n.id),ecuVariant:r.map(n.ecuVariant,function(e){return r.first(e.id)})}}e.param&&(t[i].params=r.map(e.param,function(e){return{value:r.first(e.value),id:r.first(e.id)}}))}),n=t,i()}};module.exports=function(r,e){return new t(r,e)}}();