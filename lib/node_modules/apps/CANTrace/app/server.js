"use strict";var http=require("http"),mkdirp=require("mkdirp"),box=require("BoxApplication"),server=require("Server"),config=require("./config.js"),frontEndServerClient=require("apps/FrontEndServer/Client"),ConfigStoreClient=require("apps/ConfigStore/Client"),environment=require("Environment"),app=box(config),configStoreClient=new ConfigStoreClient(app,"CANTrace"),utility=require("FileUtility"),webServer=server.createServer(module,config,[]),options={config:config,webServer:webServer,configStoreClient:configStoreClient,offlineUrl:frontEndServerClient.getOfflineUrl()};mkdirp.sync(environment.canTraceDataPath),mkdirp.sync(environment.temporaryCanTracesPath),mkdirp.sync(environment.canTraceLogs),utility.clearDirectory(environment.temporaryCanTracesPath,function(e){e&&app.error("Failed to clear can trace directory",e)}),app.use(["./canTrace/index.js","./canTrace/routes.js"],module,options);var httpServer=http.createServer(webServer);httpServer.listen(0,"127.0.0.1",function(e){e?process.exit(1):mountRoutes(function(){app.ready()})});var mountRoutes=function(e){var r=frontEndServerClient.create(app);r.addNamespace("/canTrace"),frontEndServerClient.mount(app,httpServer,function(r){var n={headers:"X-Requested-With, Content-Type, X-JobId, X-HybridSession"};r("/SAWeb/services/cantrace",{noSession:!0,allowUnauthorized:!0,corsOptions:n}),r("/SAWeb/services/cantrace/",{noSession:!0,allowUnauthorized:!0,corsOptions:n}),r("/SAWeb/services/cantrace/*",{noSession:!0,allowUnauthorized:!0,corsOptions:n}),e()})};app.on("stop",function(){httpServer.close(),app.disconnect()}),process.on("SIGINT",function(){});