"use strict";var util=require("util"),events=require("events"),path=require("path"),async=require("async"),TarIndexManager=require("TarIndexManager"),protocol=require("Protocol"),DataPathsClient=function(t,a,o){var e=this;e._publicDataRoot=a,e._app=t,e._tarAndIndexDirectories=o,e._tarIndexManager=new TarIndexManager(t,o,a),t.on(protocol.publicDataRootChanged,function(t,a){e._publicDataRoot=t,e.emit("publicDataRootChanged",t),a()}),t.on(protocol.unloadTarReaders,function(t,a){e._tarAndIndexDirectories=[],e._tarIndexManager._refreshTarReaders(e._tarAndIndexDirectories,e._publicDataRoot,a)}),t.on(protocol.loadTarReaders,function(t,a){e._tarAndIndexDirectories=t,e._tarIndexManager._refreshTarReaders(e._tarAndIndexDirectories,e._publicDataRoot),a()}),t.on(protocol.refreshTarReaders,function(t,a){e._tarIndexManager._refreshTarReaders(e._tarAndIndexDirectories,e._publicDataRoot),a()})};util.inherits(DataPathsClient,events.EventEmitter),DataPathsClient.prototype.doesDatasetExist=function(t){var a=this;a._app.request(protocol.checkPublicDataRoot,void 0,function(a){t(a.error,a.isValid)})},DataPathsClient.prototype.setTarAndIndexDirectoryLocations=function(t,a){var o=this;o._app.request(protocol.setTarAndIndexDirectoryLocations,t,function(t){a(t.error)})},DataPathsClient.prototype.getTarAndIndexDirectories=function(){return this._tarAndIndexDirectories},DataPathsClient.prototype.getTarIndexManager=function(){return this._tarIndexManager},DataPathsClient.prototype.setPublicDataRoot=function(t,a){var o=this;o._app.request(protocol.setPublicDataRoot,t,function(t){a(t.error)})},DataPathsClient.prototype.changeDatasetLocation=function(t,a){var o=this;o._app.request(protocol.changeDatasetLocation,t,function(t){a(t.error)})},DataPathsClient.prototype.getDataLocationInformation=function(t){var a=this;a._app.request(protocol.getDataLocationInformation,void 0,function(a){t(a.error,a.info)})},DataPathsClient.prototype.clearDataLocationInformation=function(t){var a=this;a._app.request(protocol.clearDataLocationInformation,void 0,function(a){t(a.error)})},DataPathsClient.prototype.clearTarAndIndexDirectoryInformation=function(t){var a=this;a._app.request(protocol.clearTarAndIndexDirectoryLocations,void 0,function(a){t(a.error)})},DataPathsClient.prototype.getPublicDataRoot=function(){return this._publicDataRoot},DataPathsClient.prototype.getDataPath=function(){return path.join(this._publicDataRoot,"Data")},DataPathsClient.prototype.getDataSetsRoot=function(){return path.join(this._publicDataRoot,"Data Sets")},DataPathsClient.prototype.getDataSetsPath=function(){return path.join(this.getDataSetsRoot(),"Data")},DataPathsClient.prototype.getDiagnosticsDataPath=function(){return path.join(this.getDataPath(),"diagnostics")},DataPathsClient.prototype.getMastertocDataPath=function(){return path.join(this.getDataPath(),"mastertoc")},DataPathsClient.prototype.getManualsDataPath=function(){return path.join(this.getDataPath(),"manuals")},DataPathsClient.prototype.getBooksDataPath=function(){return path.join(this.getManualsDataPath(),"manualbooks")},DataPathsClient.prototype.getIndexDataPath=function(){return path.join(this.getDataPath(),"indexes")},DataPathsClient.prototype.getGraphicsDataPath=function(){return path.join(this.getDataPath(),"graphics")},DataPathsClient.prototype.getDtacDataPath=function(){return path.join(this.getDataPath(),"dtac")},DataPathsClient.prototype.getSolutionsDataPath=function(){return path.join(this.getDtacDataPath(),"solutions")},DataPathsClient.prototype.getArtifactsDataPath=function(){return path.join(this.getDtacDataPath(),"artifacts")};var create=function(t,a){async.series({publicDataRoot:function(a){t.request(protocol.requestPublicDataRoot,function(t){return t?t.error||!t.path?void a(t.error||new Error("No Data Root Provided.")):void a(void 0,t.path):void a(new Error("Missing Response to Public Data Root Request."))})},tarAndIndexDirectories:function(a){t.request(protocol.requestTarAndIndexDirectoryLocations,function(t){return t?t.error||!t.directoryLocations?void a(t.error||new Error("No Tar/Index Directories Provided.")):void a(void 0,t.directoryLocations):void a(new Error("Missing Response to Tar and Index Directory Request."))})}},function(o,e){a(o,new DataPathsClient(t,e.publicDataRoot,e.tarAndIndexDirectories))})};exports.create=create;