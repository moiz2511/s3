"use strict";var _=require("underscore"),fileStream=function(t){var r=0,n=t;this.getPosition=function(){return r},this.seek=function(t){r=t},this.length=function(){return n.byteLength},this.readByte=function(){var t=n.getInt8(r);return r+=1,t},this.readInt4=function(){var t=n.getInt32(r);return r+=4,t},this.readInt8=function(){var t=(n.getInt32(r)<<32)+n.getInt32(r+4);return r+=8,t},this.readUInt8=function(){var t=(n.getUint32(r)<<32)+n.getUint32(r+4);return r+=8,t},this.readFloat4=function(){var t=n.getFloat32(r,!0);return r+=4,t},this.readFloat8=function(){var t=n.getFloat64(r,!0);return r+=8,t};var e=function(t,r){for(var e=new Array(r),i=0;i<r;i++)e[i]=n.getUint8(t+i);try{return decodeURIComponent(escape(String.fromCharCode.apply(null,e)))}catch(t){return""}};this.readString=function(t){var n=e(r,t);return r+=t,n},this.readMap=function(t,r){var n={1:"metric",2:"english",3:"alt"},e={},i=this.readInt4();return _.times(i,function(){e[n[t()]]=r()}),e},this.readSet=function(t){var r=[],n=this.readInt4();return _.times(n,function(){r.push(t())}),r},this.readValue=function(){var t=this.readByte();switch(t){case 0:return this.readStringObj();case 1:return this.readFloat8()}return{}},this.readStringObj=function(){var t=this.readInt4();return this.readString(t)}};module.exports=function(t){return new fileStream(t)};